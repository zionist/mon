{% extends "base_site.html" %}
{% load i18n staticfiles %}

{% block content %}
    <h4>{{title}}</h4>



    {% if user.is_staff %}
        <div class="row">
        <a class="btn btn-small" href="{% url 'create-payment' %}"> {% trans 'Добавить платеж' %}</a>
        <!--<a class="btn btn-small" href="{% url 'accounting' 0 %}">-->
            <!--{% trans 'Общая сводка' %}</a>-->
        <!--<a class="btn btn-small" href="{% url 'accounting' 1 %}">-->
            <!--{% trans 'Общая сводка за день' %}</a>-->
        <!--<a class="btn btn-small" href="{% url 'accounting' 2 %}">-->
            <!--{% trans 'Общая сводка за месяц' %}</a>-->
        <!--<a class="btn btn-small" href="{% url 'accounting' 3 %}">-->
            <!--{% trans 'Общая сводка за текущий год' %}</a>-->
        <!--<a class="btn btn-small" href="{% url 'accounting' 4 %}">-->
            <!--{% trans 'Общая сводка за предыдущий год' %}</a>-->
        <div class='span8'><li id="accounting" class="dropdown" style="list-style: none;">
            <a class="btn btn-small" href="#" role="button" data-toggle="dropdown">{% trans 'Общая сводка ' %}
                <b class="caret"></b></a>
            <ul class="dropdown-menu" role="menu" >
                <li><a href="{% url 'accounting' 1 %}"> {% trans 'За день' %}</a></li>
                <li><a href="{% url 'accounting' 2 %}"> {% trans 'За месяц' %}</a></li>
                <li><a href="{% url 'accounting' 3 %}"> {% trans 'За текущий год' %}</a></li>
                <li><a href="{% url 'accounting' 4 %}"> {% trans 'За предыдущий год' %}</a></li>
            </ul>
        </li>
            {% if date_form %}
            <form class='inline' method="POST" action="{% url 'date-accounting' %}"> {% csrf_token %}
                <!--<br>-->
                <!--<table border="0" width="40%"><tr>-->
                    {% for field in date_form %}
                    <td width="50%">{{ field.label_tag }}</td><td>{{ field.errors }}{{ field }}</td>
                    {% endfor %}
                    <td width="25%"><button type="submit" name="date_select"> {% trans ' Составить ' %} </button></td></tr>
                <!--</table>-->
            </form>
            {% endif %}
        </div>
    </div>

    {% else %}
    <a class="btn btn-small" href="{% url 'create-payment' %}"> {% trans 'Добавить платеж' %}</a>
        <br><div class="auction-table">
            <br><table class="table table-condensed table-striped table-hover">
                <tr>
                    <th> {% trans 'Общая сумма субвенции' %}</th>
                    <th> {% trans 'Потрачено' %}</th>
                    <th> {% trans 'Осталось' %}</th>
                    <th> {% trans '% освоения субвенции' %}</th>
                    <th> {% trans 'Экономия по результатам торгов' %}</th>
                </tr>
                <tr>
                    <td>{{accounting.sub_amount}}</td>
                    <td>{{accounting.spent}}</td>
                    <td>{{accounting.saved}}</td>
                    <td>{{accounting.percent}}</td>
                    <td>{{accounting.economy}}</td>
                </tr>
            </table>
        </div>
    {% endif %}
    <br><br>
    {% if error %}
        <div class="error">{{ error }}</div><br>
    {% endif %}
    {% if errorlist %}
        <div class="error">{{ errorlist }}</div>
    {% else %}

        {% if accountings %}
            <div class="auction-table">
            <table class="table table-condensed table-striped table-hover">
                {% regroup accountings by mo as accounting_list %}
                <tr>
                    <th> {% trans 'Общая сумма субвенции' %}</th>
                    <th> {% trans 'Осталось' %}</th>
                    <th> {% trans 'Потрачено' %}</th>
                    <th> {% trans 'Подтверждено платежными поручениями' %}</th>
                    <th> {% trans '% освоения субвенции' %}</th>
                    <th> {% trans 'Экономия по результатам торгов' %}</th>
                </tr>
                {% for mo in accounting_list %}
                    <tr><th colspan="6"> <strong>{{mo.grouper}}</strong></th></tr>
                    {% for obj in mo.list %}
                        <tr>
                            <td>{{obj.accounting.sub_amount}}</td>
                            <td>{{obj.accounting.saved}}</td>
                            <td>{{obj.accounting.spent}}</td>
                            <td>{{obj.accounting.payment}}</td>
                            <td>{{obj.accounting.percent}}</td>
                            <td>{{obj.accounting.economy}}</td>
                        </tr>
                    {% endfor %}
                {% endfor %}
            </table>
            </div>
        {% endif %}

        {% if payment_list %}
            <div class="auction-table">
            <table class="table table-condensed table-striped table-hover">
                <tr>
                    <th> {% trans 'Наименование МО' %}</th>
                    <th> {% trans 'Номер платежа' %}</th>
                    <th> {% trans 'Дата платежа' %}</th>
                    <th> {% trans 'Сумма платежа' %}</th>
                </tr>
                {% for obj in payment_list %}
                    {% if obj.id %}
                        <tr>
                            <td>{{obj.contract.mo}}</td>
                            <td><a href="{% url 'change-payment' obj.id %}">{{obj.num}}</a></td>
                            <td>{{obj.date}}</td>
                            <td>{{obj.amount}}</td>
                        </tr>
                    {% endif %}
                {% endfor %}
            </table>
            </div>
        {% endif %}
    {% endif %}
{% endblock %}